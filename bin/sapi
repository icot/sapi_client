#!/usr/bin/env python

import fire
import sapi_client
from sapi_client.api_client import ApiClient

# Configure OAuth3 access token for authorization: sso

config = sapi_client.Configuration()

config.access_token = None
config.host = 'it-db-storage-api.web.cern.ch'
config.access_token = 'dummytoken' # Need's to be defined
config.debug = False


# Get SSO cookie
from sapi_client import cern_sso
import requests

my_url = "https://it-db-storage-api.web.cern.ch/login"
cookies = cern_sso.krb_sign_on(my_url)

myd = cookies.get_dict(domain='it-db-storage-api.web.cern.ch', path='/')
ks = myd.keys()
ks.sort()
cookiestr = ' '.join(["%s=%s; " % (k,myd.get(k)) for k in ks])


# create an instance of the API class
myApiClient = ApiClient(header_name = 'Cookie', header_value = cookiestr, configuration = config)
api_instance = sapi_client.apis.sapi_api.SapiApi(myApiClient)

# create an instance of the API class

if __name__ == '__main__':
    fire.Fire(api_instance, name='sapi')
